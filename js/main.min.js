function adjustLayerbyZoom(e){if(e>11){if(!GINAdmin2){map.addLayer(guineaAdminLayer2);for(var o=0;o<GINLabels.length;o++)GINLabels[o].addTo(map);GINAdmin2=!0}}else{map.removeLayer(guineaAdminLayer2);for(var o=0;o<GINLabels.length;o++)map.removeLayer(GINLabels[o]);GINAdmin2=!1}}function triggerUiUpdate(){societe=$("#societe_scope").val(),region=$("#region_scope").val(),prefecture=$("#prefecture_scope").val(),substance=$("#substance_type").val(),console.log("All Seleceted: ",societe+"  "+region+"  "+prefecture+"  "+substance+"  "+date);var e=buildQuery(region,prefecture,sub_prefecture,date);getData(e),prefecture_select=$("#region_scope").val()}function buildQuery(e,o,t){var r=!1;return query="https://femtope.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT * FROM mine_guinea",console.log("Date in Query: ",date),o.length>0||t.length>0||societe.length>0||substance.length>0?(query=query.concat(" WHERE"),o.length>0&&(query=query.concat(" region = '".concat(o.concat("'"))),r=!0),t.length>0&&(query=query.concat(r?" AND prefecture = '".concat(t.concat("'")):" prefecture = '".concat(t.concat("'"))),r=!0),societe.length>0&&(query=query.concat(r?" AND societe = '".concat(societe.concat("'")):" societe = '".concat(societe.concat("'"))),r=!0),substance.length>0&&(query=query.concat(r?" AND substance = '".concat(substance.concat("'")):" substance = '".concat(substance.concat("'"))),r=!0)):query="https://femtope.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT * FROM mine_guinea",query}function addDataToMap(e){null!=dataLayer&&map.removeLayer(dataLayer),null!=markerGroup&&map.removeLayer(markerGroup);var o=L.icon({iconUrl:"image/dolerite.jpg",iconSize:[20,20],iconAnchor:[25,25]});$("#projectCount").text(e.features.length),markerGroup=L.markerClusterGroup({showCoverageOnHover:!1,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0}),dataLayer=L.geoJson(e,{pointToLayer:function(e,t){var r=L.marker(t,{icon:o});return r},onEachFeature:function(e,o){e.properties&&e.properties.cartodb_id&&o.on("click",function(){displayInfo(e)})}}),markerGroup.addLayer(dataLayer),map.fitBounds(dataLayer),map.addLayer(markerGroup)}function addAdminLayersToMap(e){var o={admin0:{clickable:!0,color:"#B81609",fillColor:"#ffffff",weight:2,opacity:1,fillOpacity:.05},admin2:{clickable:!0,color:"#412406",fillColor:"#80FFFFFF",weight:1.5,opacity:.5,fillOpacity:.05},region:{clickable:!0,color:"#e2095c",fillColor:"#80FFFFFF",weight:2,opacity:.7,fillOpacity:.05},prefecture:{clickable:!0,color:"#e2095c",fillColor:"#80FFFFFF",weight:2.5,opacity:.7,fillOpacity:.05},sub_prefecture:{clickable:!0,color:"#ff0000",fillColor:"#80FFFFFF",weight:2.5,opacity:.7,fillOpacity:.05}};regionSelect=$("#region_scope").val(),prefectureSelect=$("#prefecture_scope").val(),guineaAdminLayer0=L.geoJson(e.guineaAdmin0,{style:o.admin0}).addTo(map),guineaAdminLayer2=L.geoJson(e.guineaAdmin2,{style:o.region,onEachFeature:function(e,o){var t=L.divIcon({className:"labelLga-icon",html:e.properties.NAME_2});GINLabels.push(L.marker(o.getBounds().getCenter(),{icon:t}))}}),null!=region_layer&&map.removeLayer(region_layer),region_layer=L.geoJson(e.guineaAdmin1,{filter:function(e){return e.properties.NAME_1===regionSelect},style:o.region}).addTo(map),map.fitBounds(region_layer),null!=prefecture_layer&&map.removeLayer(prefecture_layer),prefecture_layer=L.geoJson(e.guineaAdmin2,{filter:function(e){return e.properties.NAME_2===prefectureSelect},style:o.region}).addTo(map),map.fitBounds(prefecture_layer),console.log("Zoom Level ",map.getZoom())}function displayInfo(e){var o=buildPopupContent(e);$("#infoContent").html(o)}function normalizeName(e){return e=e.replace("_"," ").replace("of_"," of "),e=e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function buildPopupContent(e){for(var o="",t=["date","region","prefecture","sous_prefecture","prenoms_et_nom","fonction","societe","prenom_directeur","prenom_nom_directeur","sexe_directeur","adresse_email","numero_telephone"],r=0;r<t.length;r++)o=o.concat("<p><strong>"+normalizeName(t[r])+": </strong>"+e.properties[t[r]]+"</p>");return o}function showLoader(){$(".fa-spinner").addClass("fa-spin"),$(".fa-spinner").show()}function hideLoader(){$(".fa-spinner").removeClass("fa-spin"),$(".fa-spinner").hide()}function getData(e){showLoader(),$.post(e,function(e){hideLoader(),addDataToMap(e),console.log("Data-Geo::  ",e)}).fail(function(){console.log("error!")})}function getAdminLayers(){var e={};$.get("resources/GIN_Admin0.json",function(o){e.guineaAdmin0=o,addAdminLayersToMap(e)}).fail(function(){logError(null)}),$.get("resources/GIN_Admin1.json",function(o){e.guineaAdmin1=o,addAdminLayersToMap(e)}).fail(function(){logError(null)}),$.get("resources/GIN_Admin2.json",function(o){e.guineaAdmin2=o,addAdminLayersToMap(e)}).fail(function(){logError(null)})}function logError(){console.log("error!")}function showPrefecture(){prefecture_show=document.getElementById("prefecture_id"),prefecture_show1=document.getElementById("prefecture_id1"),console.log("Show: ",prefecture_show),console.log("Show1: ",prefecture_show1),""!=prefecture_select?(prefecture_show.style.visibility="true",prefecture_show1.style.visibility="true"):(prefecture_show.style.visibility="hidden",prefecture_show1.style.visibility="hidden")}function populatedropdown(e,o,t){for(var r=new Date,e=document.getElementById(e),o=document.getElementById(o),t=document.getElementById(t),n=0;31>n;n++)e.options[n]=new Option(n+1,n+1);e.options[r.getDate()-1].selected=!0;for(var a=0;12>a;a++)o.options[a]=new Option(monthtext[a],monthtext[a]);o.options[r.getMonth()].selected=!0;for(var i=r.getFullYear()-7,c=0;15>c;c++)t.options[c]=new Option(i,i),i+=1;t.options[0]=new Option(r.getFullYear(),r.getFullYear(),!0,!0)}function changeDay(e){d=e.selectedIndex+1,console.log("Day: ",d)}function changeMonth(e){m=e.selectedIndex+1,console.log("Month: ",m)}function changeYear(e){y=e.value,date=d+"/"+m+"/"+y,console.log("Year: ",y),console.log("DATE: ",date)}var d,m,y,date,type="",distance,twokm,threekm,fourkm,region="",prefecture="",prefecture_select="",sub_prefecture="",geoData=null,dataLayer=null,markerGroup=null,guineaAdminLayer0,guineaAdminLayer1,guineaAdminLayer2,region_layer=null,prefecture_layer=null,sub_prefecture_layer=null,bufferLayer=null,substance_layer=null,GINLabels=[],within,within_fc,buffered=null,GINAdmin2=!1,googleSat=L.tileLayer("https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}),googleStreets=L.tileLayer("https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}),osm=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18}),mapbox=L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoicy1jaGFuZCIsImEiOiJjaXdmcmtnc2QwMDBhMnltczBldmc1MHZuIn0.eIdXZvG0VOOcZhhoHpUQYA"),map=L.map("map",{center:[9.6,-12.6],zoom:7,animation:!0,zoomControl:!1,layers:[osm]});map.options.minZoom=7;var baseMaps={"Google Satelite":googleSat,OSM:osm,"Google Street":googleStreets,"Map Box":mapbox};map.on("zoomend",function(){adjustLayerbyZoom(map.getZoom())}),new L.Control.Zoom({position:"topright"}).addTo(map),L.control.layers(baseMaps).addTo(map),L.control.scale({position:"bottomright",maxWidth:100,metric:!0,updateWhenIdle:!0}).addTo(map),$(document).ready(function(){var e=$("#prefecture_scope option");$("#region_scope").change(function(){$("#prefecture_scope option").remove();var o=$("#region_scope option:selected").prop("class"),t=e.filter("."+o);$.each(t,function(e,o){$(o).appendTo("#prefecture_scope")})})}),getAdminLayers(),hideLoader();var monthtext=["January","February","March","April","May","June","July","August","September","October","November","December"];onload=function(){populatedropdown("d","m","y")};
//# sourceMappingURL=main.min.js.map
